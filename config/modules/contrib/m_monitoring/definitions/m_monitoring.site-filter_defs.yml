aliases:
  - &filters_departement |
    __f__{
        return data.region
        ? `area_code in ${utils.departementsForRegion(data.region.area_code).join(';')}`
        : null
    }
  - &filters_commune |
    __f__{
        if (data.departement) {
            return `area_code like ${data.departement.area_code}%`
        }
        if (data.region) {
            return utils.departementsForRegion(data.region.area_code)
                .map(departementCode => `area_code like ${departementCode}%`)
                .join(',|,')
        }
    }
defs:
  name:
    title: Type de site
    field: category.name
    type: string
    filter_type: "="
  region:
    title: Région
    field: areas.id_area
    filter_type: "="
    type: integer
    key: id_area
  departement:
    title: Département
    field: areas.id_area
    filter_type: "="
    type: integer
    key: id_area
  commune:
    title: Commune
    field: areas.id_area
    filter_type: "="
    type: integer
layout:
  - title: Infos sites
    items:
      - key: name
        type: list_form
        title: Type de site
        value_field_name: name
        object_code: category
        module_code: m_monitoring
  - title: Localisation
    display: fieldset
    items:
      - key: region
        title: Région
        type: list_form
        return_object: "true"
        additional_fields:
          - area_code
        area_type: REG
        sort: area_name
      - reload_on_search: true
        return_object: true
        key: departement
        title: Département
        type: list_form
        area_type: DEP
        additional_fields:
          - area_code
        label_field_name: code_name
        sort: code_name
        filters: *filters_departement
      - reload_on_search: true
        key: commune
        title: Commune
        type: list_form
        area_type: COM
        label_field_name: name_code
        filters: *filters_commune
        sort: area_name
      - title: Infrastructure
        key: infrastructure
        type: list_form
        object_code: ref_geo.linear_group
        filters: linears.type.type_code = RTE
        sort: name
        reload_on_search: true
        page_size: 10
