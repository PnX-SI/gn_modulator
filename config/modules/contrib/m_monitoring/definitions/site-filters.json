{
  "_defs": {
    "_filters_departement": [
      "__f__{",
      "return data.region",
      " ? `area_code_in_${utils.departementsForRegion(data.region.area_code).join(';')}`",
      " : null",
      "}"
    ],
    "_filters_commune": [
      "__f__{",
      "  if (data.departement) {",
      "    return `area_code_like_${data.departement.area_code}`",
      "  }",
      "  if (data.region) {",
      "     return utils.departementsForRegion(data.region.area_code)",
      "       .map(departementCode => `area_code_like_${departementCode}`)",
      "       .join(',|,')",
      "  }",
      "}"
    ]
  },
  "defs": {
    "name": {
      "title": "Type de site",
      "field": "category.name",
      "type": "string",
      "filter_type": "="
    },
    "region": {
      "title": "Région",
      "field": "areas.id_area",
      "filter_type": "=",
      "type": "integer",
      "key": "id_area"
    },
    "departement": {
      "title": "Département",
      "field": "areas.id_area",
      "filter_type": "=",
      "type": "integer",
      "key": "id_area"
    },
    "commune": {
      "title": "Commune",
      "field": "areas.id_area",
      "filter_type": "=",
      "type": "integer"
    }
  },
  "layout": [
    {
      "title": "Infos sites",
      "items": [
        {
          "key": "name",
          "type": "list_form",
          "title": "Type de site",
          "value_field_name": "name",
          "object_name": "category",
          "module_code": "m_monitoring"
        }
      ]
    },
    {
      "title": "Localisation",
      "display": "fieldset",
      // "hidden": true,
      "items": [
        {
          "key": "region",
          "title": "Région",
          "type": "list_form",
          "return_object": "true",
          "additional_fields": [
            "area_code"
          ],
          "area_type": "REG",
          "sort": "area_name"
        },
        {
          "reload_on_search": true,
          "return_object": true,
          "key": "departement",
          "title": "Département",
          "type": "list_form",
          "area_type": "DEP",
          "additional_fields": [
            "area_code"
          ],
          "sort": "area_name",
          "filters": "_filters_departement"
        },
        {
          "reload_on_search": true,
          "key": "commune",
          "title": "Commune",
          "type": "list_form",
          "area_type": "COM",
          "filters": "_filters_commune",
          "sort": "area_name"
        },
        {
          "title": "Infrastructure",
          "key": "infrastructure",
          "type": "list_form",
          "object_name": "ref_geo.linear_group",
          "filters": "linears.type.type_code_=_RTE",
          "sort": "name",
          "data_reload_on_search": true,
          "page_size": 10
        }
      ]
    }
  ]
}